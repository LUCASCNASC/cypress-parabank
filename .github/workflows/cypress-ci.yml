# .github/workflows/cypress-ci.yml

# Nome do seu workflow que aparecerÃ¡ no GitHub Actions
name: ğŸ§ª Cypress E2E (CI/CD)

# Define os eventos que disparam o workflow
on:
  # Roda quando hÃ¡ um push para a branch 'main' ou 'master'
  push:
    branches: [ main, master ]
  # Roda quando hÃ¡ um Pull Request (PR) aberto contra 'main' ou 'master'
  pull_request:
    branches: [ main, master ]

jobs:
  cypress-run:
    # Define o ambiente da mÃ¡quina virtual
    runs-on: ubuntu-latest
    
    # Passos a serem executados
    steps:
      # Passo 1: Checa o seu cÃ³digo (checkout)
      - name: ğŸ›ï¸ Checkout
        uses: actions/checkout@v4
        
      # Passo 2: Instala o Node.js
      - name: ğŸ› ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20 # Use uma versÃ£o LTS estÃ¡vel
          
      # Passo 3: Instala as dependÃªncias (Cypress, TypeScript, Faker, etc.)
      # 'npm ci' Ã© mais rÃ¡pido e confiÃ¡vel em CI do que 'npm install'
      - name: ğŸ“¦ Install dependencies
        run: npm ci

      # Passo 4: Executa os testes Cypress
      # Usamos a aÃ§Ã£o oficial do Cypress, que cuida de dependÃªncias do browser
      - name: ğŸƒ Run Cypress E2E tests
        uses: cypress-io/github-action@v6
        with:
          # Comando para rodar seus testes (o Cypress usa o 'cypress run' por padrÃ£o)
          # Usa o navegador padrÃ£o (Chrome ou Electron) em modo headless
          command: npx cypress run
          
      # Passo 5 (Opcional): Upload de Artefatos (Screenshots e VÃ­deos)
      # Se um teste falhar, vocÃª terÃ¡ as evidÃªncias
      - name: ğŸ“¤ Upload Artifacts (on failure)
        uses: actions/upload-artifact@v4
        if: failure() # Executa SOMENTE se o job falhar
        with:
          name: cypress-artifacts
          path: cypress/screenshots
          # path: cypress/videos # Inclua vÃ­deos se estiver gerando no seu configuraÃ§Ã£o Cypress